<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Fetching and Loading CSV Data from URL into Spark DataFrame for Analysis</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            line-height: 1.6;
            background-color: #f4f4f9;
            color: #333;
            margin: 0;
            padding: 0;
        }
        header {
            background-color: #4CAF50;
            color: white;
            padding: 20px;
            text-align: center;
        }
        header h1 {
            margin: 0;
            font-size: 2.5rem;
        }
        .container {
            max-width: 1100px;
            margin: 40px auto;
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        h2 {
            color: #333;
            font-size: 1.8rem;
            margin-bottom: 20px;
        }
        p {
            font-size: 1.1rem;
            margin-bottom: 20px;
        }
        .code-block {
            background-color: #282c34;
            color: white;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 1rem;
            white-space: pre-wrap;
            word-wrap: break-word;
            margin-bottom: 30px;
        }
        .code-block code {
            font-family: 'Courier New', monospace;
            font-size: 1rem;
        }
        .image-section {
            display: flex;
            justify-content: space-between;
            gap: 10px;
            margin-bottom: 40px;
        }
        .image-section img {
            width: 48%;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .quote {
            background-color: #f9f9f9;
            border-left: 5px solid #4CAF50;
            padding-left: 15px;
            font-style: italic;
            color: #555;
        }
        footer {
            text-align: center;
            padding: 20px;
            background-color: #333;
            color: white;
            font-size: 1rem;
        }
    </style>
</head>
<body>
    <header>
        <h1>Fetching and Processing CSV Data with Apache Spark</h1>
    </header>

    <div class="container">
        <h2>Introduction</h2>
        <p>
            I wanted to fetch a CSV file from a URL, process it, and load it into a Spark DataFrame to analyze the data.
            To do this, I used Apache Spark and Scala. The following steps outline the approach taken:
        </p>

        <h2>Steps Involved</h2>
        <p>
            First, I imported the necessary libraries:
            <ul>
                <li><strong>IOUtils</strong> from Apache Commons IO to read the content from the URL.</li>
                <li><strong>URL</strong> from Java to represent the CSV fileâ€™s URL.</li>
                <li><strong>SparkSession</strong> from Apache Spark to initialize a Spark session and work with the DataFrame.</li>
                <li><strong>Files</strong> and <strong>Paths</strong> from Java to handle file operations.</li>
            </ul>
            Then, I created an object <strong>CSVFromURLToDataFrame</strong> and defined the main method. Inside the main method:
        </p>

        <p class="quote">
            "This allowed me to easily fetch, process, and analyze the CSV data using Apache Spark and Scala."
        </p>

        <h2>Full Scala Code</h2>
        <div class="code-block">
            <code>
import org.apache.commons.io.IOUtils
import java.net.URL
import org.apache.spark.sql.{SparkSession}
import java.nio.file.{Files, Paths}

object CSVFromURLToDataFrame {
  def main(args: Array[String]): Unit = {
    // Initialize SparkSession
    val spark = SparkSession.builder()
      .appName("CSV from URL to DataFrame")
      .master("local[*]")  // Local mode, change to your cluster settings if running on a cluster
      .getOrCreate()

    // Define the URL for the CSV file
    val urlfile = new URL("https://people.sc.fsu.edu/~jburkardt/data/csv/airtravel.csv")

    // Fetch the CSV content from the URL as a string
    val csvContent = IOUtils.toString(urlfile, "UTF-8")

    // Save the CSV content to a temporary file
    val tempFilePath = "/tmp/airtravel.csv"  // You can choose any valid path here
    Files.write(Paths.get(tempFilePath), csvContent.getBytes("UTF-8"))

    // Read the CSV file into a DataFrame using Spark
    val testcsv = spark
      .read
      .option("header", "true")   // CSV file has a header
      .option("inferSchema", "true") // Auto infer column data types
      .csv(tempFilePath)

    // Show the DataFrame (first 20 rows by default)
    testcsv.show()

    // Stop SparkSession
    spark.stop()
  }
}
            </code>
        </div>

        <h2>Execution Screenshots</h2>
        <div class="image-section">
            <img src="https://raw.githubusercontent.com/nbahador/nbahador.github.io/main/assets/img/spark15.png" alt="Spark Terminal Screenshot 1">
            <img src="https://raw.githubusercontent.com/nbahador/nbahador.github.io/main/assets/img/spark16.png" alt="Spark Terminal Screenshot 2">
        </div>
    </div>

    <footer>
        <p>&copy; 2025 Apache Spark Tutorial | All rights reserved</p>
    </footer>
</body>
</html>
