<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Fetching a CSV File from a URL and Loading it into a Spark DataFrame</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
        }
        header {
            background-color: #4CAF50;
            color: white;
            padding: 20px 0;
            text-align: center;
        }
        header h1 {
            margin: 0;
        }
        main {
            max-width: 1200px;
            margin: 30px auto;
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        h2 {
            color: #333;
            margin-bottom: 10px;
        }
        p {
            color: #555;
            margin-bottom: 20px;
        }
        code {
            background-color: #f4f4f4;
            border-radius: 5px;
            padding: 5px 10px;
            font-family: 'Courier New', monospace;
            color: #333;
        }
        pre {
            background-color: #2e2e2e;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin-bottom: 30px;
            font-size: 14px;
            line-height: 1.6;
            word-wrap: break-word;
        }
        pre code {
            display: block;
            color: #f8f8f2;
            white-space: pre-wrap;
        }
        .screenshot-container {
            display: flex;
            justify-content: space-between;
            gap: 10px;
            margin-bottom: 30px;
        }
        .screenshot-container img {
            max-width: 48%;
            border-radius: 8px;
        }
        footer {
            background-color: #333;
            color: white;
            text-align: center;
            padding: 15px 0;
            position: fixed;
            width: 100%;
            bottom: 0;
        }
    </style>
</head>
<body>

<header>
    <h1>Fetching a CSV File from a URL and Loading it into a Spark DataFrame</h1>
</header>

<main>
    <section>
        <h2>Overview</h2>
        <p>
            I wanted to fetch a CSV file from a URL, process it, and load it into a Spark DataFrame for data analysis. 
            To achieve this, I used Apache Spark and Scala.
        </p>
    </section>

    <section>
        <h2>Required Libraries</h2>
        <p>First, I imported the necessary libraries:</p>
        <ul>
            <li><strong>IOUtils</strong> from Apache Commons IO to read the content from the URL.</li>
            <li><strong>URL</strong> from Java to represent the CSV file’s URL.</li>
            <li><strong>SparkSession</strong> from Apache Spark to initialize a Spark session and work with the DataFrame.</li>
            <li><strong>Files and Paths</strong> from Java to handle file operations.</li>
        </ul>
    </section>

    <section>
        <h2>Code Explanation</h2>
        <p>
            Then, I created an object called <strong>CSVFromURLToDataFrame</strong> and defined the main method. Inside the main method:
        </p>
        <ul>
            <li>I initialized a Spark session using <code>SparkSession.builder()</code>.</li>
            <li>I defined the URL pointing to the CSV file hosted online.</li>
            <li>I used <code>IOUtils.toString()</code> to fetch the CSV content from the URL as a string.</li>
            <li>I saved this CSV content to a temporary local file using <code>Files.write()</code>.</li>
            <li>I read the CSV file into a DataFrame using Spark’s <code>.csv()</code> method, applying options like <code>header=true</code> (to treat the first row as column names) and <code>inferSchema=true</code> (to let Spark automatically infer the column data types).</li>
            <li>I displayed the DataFrame using <code>.show()</code> to see its contents.</li>
            <li>Finally, I stopped the Spark session with <code>spark.stop()</code> to clean up resources.</li>
        </ul>
        <p>This process allowed me to easily fetch, process, and analyze the CSV data using Apache Spark and Scala.</p>
    </section>

    <section>
        <h2>Code</h2>
        <pre><code>
import org.apache.commons.io.IOUtils
import java.net.URL
import org.apache.spark.sql.{SparkSession}
import java.nio.file.{Files, Paths}

object CSVFromURLToDataFrame {
  def main(args: Array[String]): Unit = {
    // Initialize SparkSession
    val spark = SparkSession.builder()
      .appName("CSV from URL to DataFrame")
      .master("local[*]")  // Local mode, change to your cluster settings if running on a cluster
      .getOrCreate()

    // Define the URL for the CSV file
    val urlfile = new URL("https://people.sc.fsu.edu/~jburkardt/data/csv/airtravel.csv")

    // Fetch the CSV content from the URL as a string
    val csvContent = IOUtils.toString(urlfile, "UTF-8")

    // Save the CSV content to a temporary file
    val tempFilePath = "/tmp/airtravel.csv"  // You can choose any valid path here
    Files.write(Paths.get(tempFilePath), csvContent.getBytes("UTF-8"))

    // Read the CSV file into a DataFrame using Spark
    val testcsv = spark
      .read
      .option("header", "true")   // CSV file has a header
      .option("inferSchema", "true") // Auto infer column data types
      .csv(tempFilePath)

    // Show the DataFrame (first 20 rows by default)
    testcsv.show()

    // Stop SparkSession
    spark.stop()
  }
}
        </code></pre>
    </section>

    <section>
        <h2>Screenshots</h2>
        <div class="screenshot-container">
            <img src="https://raw.githubusercontent.com/nbahador/nbahador.github.io/main/assets/img/spark15.png" alt="Code execution screenshot 1">
            <img src="https://raw.githubusercontent.com/nbahador/nbahador.github.io/main/assets/img/spark16.png" alt="Code execution screenshot 2">
        </div>
    </section>
</main>

<footer>
    <p>&copy; 2025 Your Name. All rights reserved.</p>
</footer>

</body>
</html>
